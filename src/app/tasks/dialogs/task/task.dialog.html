<h1 mat-dialog-title *ngIf="data.variant === TaskDialogVariant.EDIT" i18n>Edit task: {{ data.task?.name }}</h1>
<h1 mat-dialog-title *ngIf="data.variant === TaskDialogVariant.CREATE && !data.subtask" i18n>Create new task</h1>
<h1 mat-dialog-title *ngIf="data.subtask" i18n>Create new subtask</h1>
<div mat-dialog-content>
  <form (submit)="confirm()" [formGroup]="form" autocomplete="off">

    <!-- Workspace -->
    <app-select *ngIf="!data.subtask" formControlName="workspaceId" floatingLabel="Workspace" i18n-floatingLabel>
      <app-option *ngFor="let workspace of workspaceList$ | async" [value]="workspace.id">{{ workspace.name }}
      </app-option>
    </app-select>

    <!-- Project -->
    <ng-container *ngIf="!data.subtask && form.get('workspaceId')?.value">
      <app-select formControlName="projectId" floatingLabel="Project" i18n-floatingLabel>
        <app-option *ngFor="let project of projectList$ | async" [value]="project.id">{{project.name}}
        </app-option>
      </app-select>
    </ng-container>

    <!-- Type field -->
    <app-select formControlName="type" floatingLabel="Type" i18n-floatingLabel>
      <app-option *ngFor="let type of taskTypes" [value]="type[1]" [icon]="type[0] | taskTypeIcon">{{ type[0] | taskType
        }}
      </app-option>
    </app-select>

    <!-- Name field -->
    <app-input floatingLabel="Name" placeholder="New task" formControlName="name" i18n-floatingLabel i18n-placeholder>
    </app-input>

    <!-- Description field -->
    <app-textarea floatingLabel="Description" placeholder="Sample description..." formControlName="description"
      i18n-floatingLabel i18n-placeholder [rows]="10"></app-textarea>

    <!-- Status -->
    <app-select formControlName="statusId" floatingLabel="Status" i18n-floatingLabel>
      <app-option *ngFor="let status of statusList$ | async" [value]="status.id">{{ status.name }}
      </app-option>
    </app-select>

    <!-- Priorities -->
    <app-select formControlName="priority" floatingLabel="Priority" i18n-floatingLabel>
      <app-option *ngFor="let priority of taskPriorities" [value]="priority" [icon]="priority | taskPriorityIcon">{{
        priority | taskPriority }}</app-option>
    </app-select>

    <!-- GitHub issue integration -->
    <app-checkbox *ngIf="isGitHubIntegrationAvailable" formControlName="connectWithIssueOnGitHub" i18n>Create or attach
      GitHub issue simultaneously</app-checkbox>

    <div [class.hidden]="!form.get('connectWithIssueOnGitHub')?.value" class="git-issue-connection">
      <app-select formControlName="issueAttachGithub">
        <app-option [value]="false" i18n>Create</app-option>
        <app-option [value]="true" i18n>Attach</app-option>
      </app-select>

      <app-select [class.hidden]="!form.get('issueAttachGithub')?.value" formControlName="issue" floatingLabel="Issue"
        i18n-floatingLabel>
        <app-option *ngFor="let issue of issueList$ | async" [value]="issue">{{issue.title}}</app-option>
      </app-select>
    </div>

    <!-- Github pull request integration -->
    <app-checkbox *ngIf="isGitHubIntegrationAvailable" formControlName="connectWithPullRequestOnGitHub" i18n>
      Connect with GitHub pull request
    </app-checkbox>

    <div [class.hidden]="!form.get('connectWithPullRequestOnGitHub')?.value" class="git-pull-connection">
      <app-select formControlName="pull" floatingLabel="Pull request" i18n-floatingLabel>
        <app-option *ngFor="let pullRequest of pullList$ | async" [value]="pullRequest">{{pullRequest.title}}
        </app-option>
      </app-select>
    </div>

  </form>
</div>
<div mat-dialog-actions>
  <app-button mat-button (click)="cancel()" i18n>Cancel</app-button>
  <app-button *ngIf="data.variant === TaskDialogVariant.CREATE" (click)="confirm()" variant="primary" i18n>Create
  </app-button>
  <app-button *ngIf="data.variant === TaskDialogVariant.EDIT" (click)="confirm()" variant="primary" i18n>Save changes
  </app-button>
</div>
